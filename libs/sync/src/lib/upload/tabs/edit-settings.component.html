@if (!!fields && !!form) {
  <form
    [formGroup]="form"
    qa="fields-form"
    (ngSubmit)="save()">
    <pa-input formControlName="title">
      {{ 'upload.source.name' | translate }}
    </pa-input>
    @for (field of fields; track field.id) {
      <div
        formGroupName="fields"
        class="field">
        @if (field.type === 'text') {
          <pa-input
            [help]="field.help ? (field.help | translate) : undefined"
            [placeholder]="field.placeholder"
            [formControlName]="field.id">
            {{ field.label | translate }}
          </pa-input>
        }
        @if (field.type === 'textarea') {
          <pa-textarea
            [help]="field.help ? (field.help | translate) : undefined"
            [formControlName]="field.id">
            {{ field.label | translate }}
          </pa-textarea>
        }
        @if (field.type === 'table') {
          <div>
            <h3 class="title-s">{{ field.label | translate }}</h3>
            @if (field.help) {
              <p>{{ field.help | translate }}</p>
            }
            <app-parameters-table
              [values]="tables[field.id] || []"
              (valuesChanges)="updateTable(field.id, $event)"></app-parameters-table>
          </div>
        }
      </div>
    }
    @if (canSyncSecurityGroups) {
      <pa-toggle
        formControlName="syncSecurityGroups"
        labelOnRight
        [help]="'upload.sync.security-groups.help' | translate">
        {{ 'upload.sync.security-groups.label' | translate }}
      </pa-toggle>
    }

    <pa-button
      qa="save-button"
      [disabled]="!form.valid"
      type="submit">
      {{ 'action.save' | translate }}
    </pa-button>
  </form>
}
