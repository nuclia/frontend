<pa-modal-advanced fitContentHeight>
  <pa-modal-title>
    {{ 'kb.create.title' | translate }}
  </pa-modal-title>
  <pa-modal-content>
    @if (kbForm) {
      <form
        class="form-container"
        [formGroup]="kbForm"
        (ngSubmit)="save()">
        @if (step === 0) {
          <pa-input
            id="kb-title"
            formControlName="title"
            data-cy="new-kb-name-input"
            [errorMessages]="validationMessages['title']">
            {{ 'kb.name' | translate }}
          </pa-input>

          <pa-textarea
            id="kb-description"
            formControlName="description"
            data-cy="new-kb-description-input"
            [rows]="4">
            {{ 'generic.description' | translate }}
          </pa-textarea>

          @if (zones.length > 0) {
            <div class="kb-add-zone">
              <pa-select
                formControlName="zone"
                data-cy="new-kb-zone-select"
                [label]="'generic.zone' | translate"
                [readonly]="zones.length === 1"
                class="kb-add-zone-select">
                @for (zone of zones; track zone.id) {
                  <pa-option [value]="zone.slug">
                    {{ zone.title }}
                  </pa-option>
                }
              </pa-select>
            </div>
          }
        } @else if (step === 1) {
          <div class="learning-config">
            <nus-language-field (languageSelected)="updateLanguages($event)"></nus-language-field>

            @if (isAnonymizationEnabled | async) {
              <pa-toggle
                formControlName="anonymization"
                data-cy="new-kb-anonymization"
                labelOnRight
                [help]="'kb.ai-models.anonymization_toggle.help' | translate">
                {{ 'kb.ai-models.anonymization_toggle.label' | translate }}
              </pa-toggle>
            }
          </div>
          @if (creationInProgress) {
            <div class="saving-spinner">
              <nsi-spinner size="large"></nsi-spinner>
              <p>{{ 'kb.create.in_progress' | translate }}</p>
            </div>
          }
        }
      </form>
    }
  </pa-modal-content>

  <pa-modal-footer>
    <div class="kb-creation-footer">
      <div class="footer-buttons">
        @if (step > 0) {
          <pa-button
            aspect="basic"
            [disabled]="saving"
            (click)="back()">
            {{ 'generic.back' | translate }}
          </pa-button>
        }

        @if (step === lastStep) {
          <pa-button
            type="submit"
            kind="primary"
            data-cy="new-kb-save-button"
            [disabled]="saving"
            (click)="save()">
            {{ 'generic.save' | translate }}
          </pa-button>
        }

        @if (step < lastStep) {
          <pa-button
            data-cy="new-kb-next-button"
            [disabled]="step === 0 && kbForm?.invalid"
            (click)="next()">
            {{ 'generic.next' | translate }}
          </pa-button>
        }
      </div>
      <div class="steps">
        <small>{{ step + 1 }} / {{ totalSteps }}</small>
      </div>
    </div>
  </pa-modal-footer>
</pa-modal-advanced>
