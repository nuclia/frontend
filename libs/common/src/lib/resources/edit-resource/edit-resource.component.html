<div class="edit-resource">
  <header>
    <div class="header-left-block">
      <div class="navigation-buttons">
        <pa-button
          icon="chevrons-left"
          aspect="basic"
          data-cy="back-to-resources"
          [paTooltip]="'resource.tooltip.back-to-resources' | translate"
          (click)="backToResources()">
          {{ 'resource.tooltip.back-to-resources' | translate }}
        </pa-button>
        <pa-button
          icon="chevron-left"
          aspect="basic"
          data-cy="previous-resource"
          [disabled]="
            (resourceNavigationService.hasData | async) === false || (resourceNavigationService.isFirstResource | async)
          "
          [paTooltip]="'resource.tooltip.previous-resource' | translate"
          (click)="previousResource()">
          {{ 'resource.tooltip.previous-resource' | translate }}
        </pa-button>
        <pa-button
          icon="chevron-right"
          aspect="basic"
          data-cy="next-resource"
          [disabled]="
            (resourceNavigationService.hasData | async) === false || (resourceNavigationService.isLastResource | async)
          "
          [paTooltip]="'resource.tooltip.next-resource' | translate"
          (click)="nextResource()">
          {{ 'resource.tooltip.next-resource' | translate }}
        </pa-button>
      </div>

      <div
        class="title-s"
        paEllipsisTooltip>
        {{ (resource | async)?.title }}
      </div>
    </div>
    <div class="actions">
      <pa-button
        icon="eye"
        routerLink="preview"
        [active]="currentView === 'preview'"
        paTooltip="resource.tooltip.preview"
        aspect="basic"
        (click)="onViewChange()">
        {{ 'resource.tooltip.preview' | translate }}
      </pa-button>
      <pa-button
        icon="edit"
        routerLink="resource"
        [active]="currentView === 'resource'"
        [disabled]="(isAdminOrContrib | async) === false"
        paTooltip="resource.tooltip.edition"
        aspect="basic"
        (click)="onViewChange()">
        {{ 'resource.tooltip.edition' | translate }}
      </pa-button>
      <pa-button
        icon="label"
        routerLink="classification"
        [active]="currentView === 'classification'"
        paTooltip="resource.tooltip.classification"
        aspect="basic"
        (click)="onViewChange()">
        {{ 'resource.tooltip.classification' | translate }}
      </pa-button>
      <pa-button
        icon="form"
        routerLink="annotation"
        [active]="currentView === 'annotation'"
        paTooltip="resource.tooltip.annotation"
        aspect="basic"
        (click)="onViewChange()">
        {{ 'resource.tooltip.annotation' | translate }}
      </pa-button>
      <pa-button
        *ngIf="isPdfAnnotationEnabled | async"
        icon="annotate"
        [disabled]="(isAdminOrContrib | async) === false"
        paTooltip="resource.tooltip.pdf-annotation"
        aspect="basic"
        (click)="goToPawls()"></pa-button>
      <pa-button
        icon="more-vertical"
        aspect="basic"
        paTooltip="resource.menu.label"
        [paPopup]="resourceMenu">
        {{ 'resource.menu.label' | translate }}
      </pa-button>

      <pa-dropdown #resourceMenu>
        <pa-option
          [disabled]="(resource | async)?.metadata?.status === 'PENDING' || (isAdminOrContrib | async) === false"
          (selectOption)="reprocessResource()">
          {{ 'resource.tooltip.reprocess' | translate }}
        </pa-option>
        <pa-option
          destructive
          [disabled]="(isAdminOrContrib | async) === false"
          (selectOption)="deleteResource()">
          {{ 'resource.tooltip.delete' | translate }}
        </pa-option>
      </pa-dropdown>
    </div>
  </header>

  <div class="page-container">
    <nav>
      <ul>
        @if (currentView !== 'add-field') {
          @if (currentView !== 'annotation') {
            <li
              [class.active]="(currentField | async) === 'resource'"
              (click)="navigateToField('resource')">
              <pa-icon
                name="file"
                size="small"></pa-icon>
              {{ 'resource.profile' | translate }}
            </li>
          }
          @for (field of fields | async; track field.field_id) {
            <li
              [class.active]="
                activeField !== 'resource' &&
                activeField?.field_id === field.field_id &&
                activeField?.field_type === field.field_type
              "
              (click)="navigateToField(field)">
              <pa-icon
                [name]="field.icon"
                size="small"></pa-icon>
              {{ 'resource.field-' + field.field_type | translate }}

              <span
                class="error-marker"
                *ngIf="field.hasError">
                <pa-icon
                  name="warning"
                  size="small"></pa-icon>
              </span>
            </li>
          }
        }

        @if ((isAdminOrContrib | async) === true) {
          <li
            routerLink="add-field"
            routerLinkActive="active"
            (click)="onViewChange()">
            <pa-icon
              name="plus"
              size="small"></pa-icon>
            {{ 'resource.tooltip.add-field' | translate }}
          </li>
        }
      </ul>
    </nav>
    <div class="page-content">
      <router-outlet></router-outlet>
    </div>
  </div>
</div>
