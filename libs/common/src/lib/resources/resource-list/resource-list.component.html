<div class="resource-list page-spacing">
  @if ((emptyKb | async) === true) {
    <div
      class="empty-kb"
      data-cy="empty-kb">
      <div class="title-m">{{ 'resource.empty.title' | translate }}</div>
      <div class="body-m">{{ 'resource.empty.description' | translate }}</div>
      @if (isAdminOrContrib | async) {
        <div>
          <stf-upload-button></stf-upload-button>
        </div>
      }
    </div>
  } @else if ((emptyKb | async) === false) {
    <div class="resource-list-header">
      <div class="filters-container">
        <div class="filters">
          <div>
            <nsi-dropdown-button
              freeWidth
              aspect="basic"
              [disabled]="!hasFilters"
              [popupRef]="availableFilters">
              {{ 'resource.filtered-by' | translate }}
            </nsi-dropdown-button>
            <pa-dropdown #availableFilters>
              @if (filterOptions.classification.length > 0) {
                <pa-option-header>{{ 'resource.classification-column' | translate }}</pa-option-header>

                @for (option of filterOptions.classification; track option.id) {
                  <pa-option
                    (selectOption)="onSelectFilter(option, $event)"
                    dontCloseOnSelect>
                    <pa-checkbox
                      [(value)]="option.selected"
                      (valueChange)="onToggleFilter()">
                      {{ option.label }}
                    </pa-checkbox>
                  </pa-option>
                }
              }
              @if (filterOptions.classification.length > 0 && filterOptions.mainTypes.length > 0) {
                <pa-separator></pa-separator>
              }
              @if (filterOptions.mainTypes.length > 0) {
                <pa-option-header>{{ 'resource.filter.main-type' | translate }}</pa-option-header>
                @for (option of filterOptions.mainTypes; track option.id) {
                  <pa-option
                    (selectOption)="onSelectFilter(option, $event)"
                    [paTooltip]="option.help"
                    dontCloseOnSelect>
                    <pa-checkbox
                      [(value)]="option.selected"
                      (valueChange)="onToggleFilter()">
                      {{ option.label }}
                    </pa-checkbox>
                  </pa-option>
                }
              }
            </pa-dropdown>
          </div>

          <pa-input
            icon="search"
            [value]="query | async"
            (valueChange)="onQueryChange($event)"
            (keyup.enter)="search()"
            [disabled]="!isMainView">
            {{ 'stash.search' | translate }}
          </pa-input>
        </div>

        @if (isAdminOrContrib | async) {
          <stf-upload-button></stf-upload-button>
        }
      </div>

      <div class="active-filters">
        @if (((statusCount | async)?.pending || 0) + ((statusCount | async)?.error || 0) > 0) {
          @if ((statusCount | async)?.processed || 0 > 0) {
            <pa-chip-selectionable
              [selected]="isProcessedView"
              (select)="goToView(isProcessedView ? '' : 'processed')"
              [icon]="{ name: 'circle-check' }"
              [backgroundColor]="isProcessedView ? '#EDEBFD' : undefined">
              {{ 'resource.processed' | translate }} ({{ (statusCount | async)?.processed }})
            </pa-chip-selectionable>
          }
          @if ((statusCount | async)?.pending || 0 > 0) {
            <pa-chip-selectionable
              [selected]="isPendingView"
              (select)="goToView(isPendingView ? '' : 'pending')"
              [icon]="{ name: 'clock-dash' }"
              [backgroundColor]="isPendingView ? '#EDEBFD' : undefined">
              {{ 'resource.processing' | translate }} ({{ (statusCount | async)?.pending }})
            </pa-chip-selectionable>
          }
          @if ((statusCount | async)?.error || 0 > 0) {
            <pa-chip-selectionable
              [selected]="isErrorView"
              (select)="goToView(isErrorView ? '' : 'error')"
              [icon]="{ name: 'warning' }"
              [backgroundColor]="isErrorView ? '#EDEBFD' : undefined">
              {{ 'resource.errors' | translate }} ({{ (statusCount | async)?.error }})
            </pa-chip-selectionable>
          }
        }
        @if (isFiltering | async) {
          <div class="filtered-by title-xxs">{{ 'resource.filtered-by' | translate }}</div>
        }
        @for (option of selectedClassifications; track option.value) {
          <pa-chip-closeable (closed)="onCloseFilter(option)">{{ option.label }}</pa-chip-closeable>
        }
        @for (option of selectedMainTypes; track option.value) {
          <pa-chip-closeable (closed)="onCloseFilter(option)">{{ option.label }}</pa-chip-closeable>
        }
        @if (showClearButton | async) {
          <pa-button
            size="small"
            aspect="basic"
            (click)="clearFilters()">
            {{ 'resource.filter.clear' | translate }}
          </pa-button>
        }
        <!--
          <pa-button
            routerLink="./pending"
            routerLinkActive
            #rla="routerLinkActive"
            icon="clock-dash"
            size="small"
            iconSize="medium"
            aspect="basic"
            iconAndText
            #pendingPopoverDirective="paPopoverRef"
            [paPopover]="pendingPopover"
            paPopoverOffset="0px"
            [active]="rla.isActive">
            {{ (statusCount | async)?.pending }}
          </pa-button>
        </div>
        <pa-popover #pendingPopover>
          <div class="popover-content">{{ 'resource.popover.pending-resources' | translate }}</div>
        </pa-popover>

        @if ((statusCount | async)?.error || 0 > 0) {
          <div class="status-button">
            <pa-button
              routerLink="./error"
              routerLinkActive
              #rla="routerLinkActive"
              icon="warning"
              size="small"
              iconSize="medium"
              kind="destructive"
              aspect="basic"
              iconAndText
              #failedPopoverDirective="paPopoverRef"
              [paPopover]="failedPopover"
              paPopoverOffset="0px"
              [active]="rla.isActive">
              {{ (statusCount | async)?.error }}
            </pa-button>
          </div>
        }
        <pa-popover #failedPopover>
          <div class="popover-content">{{ 'resource.popover.error-resources' | translate }}</div>
        </pa-popover>
        -->
      </div>
    </div>

    <div class="resource-list-content">
      <router-outlet></router-outlet>
    </div>
  }
</div>
