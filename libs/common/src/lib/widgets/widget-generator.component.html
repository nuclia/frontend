<div class="widget-generator">
  <h1>
    {{ 'stash.widgets.title' | translate }}
  </h1>

  <div
    class="warning"
    *ngIf="showWarning | async">
    <pa-icon
      name="warning"
      size="large"></pa-icon>
    <div class="warning-content">
      <div
        class="title-m"
        [innerHTML]="'stash.widgets.warning' | translate"></div>
      <div
        *ngIf="showLink | async"
        class="publish-link body-m">
        <span [innerHTML]="'stash.widgets.publish_kb' | translate"></span>
        <a [routerLink]="homeUrl | async">{{ 'stash.widgets.publish_kb_link' | translate }}</a>
      </div>
    </div>
  </div>

  <div
    class="widget-preview"
    [class.dark]="mainForm?.controls?.['darkMode']?.value">
    <h3>{{ 'stash.widgets.preview' | translate }}</h3>
    <div
      id="preview"
      class="preview-container"
      [innerHtml]="snippetPreview"></div>
  </div>

  <form
    *ngIf="mainForm"
    [formGroup]="mainForm">
    <div class="snippet-configuration-container">
      <section class="snippet-configuration">
        <h3>{{ 'stash.widgets.configuration' | translate }}</h3>
        <pa-input
          [(value)]="placeholder"
          (valueChange)="onPlaceholderChange($event)">
          {{ 'stash.widgets.placeholder' | translate }}
        </pa-input>
        <pa-textarea
          *ngIf="isUserPromptsEnabled | async"
          [help]="'stash.widgets.prompt.help' | translate"
          formControlName="prompt">
          {{ 'stash.widgets.prompt.label' | translate }}
        </pa-textarea>
        <div
          class="widget-features"
          formGroupName="features">
          <pa-toggle
            labelOnRight
            help="stash.widgets.suggestions.help"
            formControlName="suggestions">
            {{ 'stash.widgets.suggestions.label' | translate }}
          </pa-toggle>
          <pa-toggle
            *ngIf="canSuggestEntities | async"
            labelOnRight
            help="stash.widgets.autocompleteFromNERs.help"
            formControlName="autocompleteFromNERs">
            {{ 'stash.widgets.autocompleteFromNERs.label' | translate }}
          </pa-toggle>
          <pa-toggle
            *ngIf="isTrainingEnabled | async"
            labelOnRight
            help="stash.widgets.suggestLabels.help"
            formControlName="suggestLabels">
            {{ 'stash.widgets.suggestLabels.label' | translate }}
          </pa-toggle>
          <pa-toggle
            labelOnRight
            help="stash.widgets.filter.help"
            formControlName="filter">
            {{ 'stash.widgets.filter.label' | translate }}
          </pa-toggle>
          <div
            *ngIf="mainFormFeatures.filter"
            class="filter-type">
            <pa-checkbox
              [(value)]="filters.labels"
              (valueChange)="onFiltersChange()"
              [disabled]="filters.labels && hasOneFilter">
              {{ 'stash.widgets.labels' | translate }}
            </pa-checkbox>
            <pa-checkbox
              [(value)]="filters.labelFamilies"
              (valueChange)="onFiltersChange()"
              [disabled]="filters.labelFamilies && hasOneFilter">
              {{ 'stash.widgets.labelFamilies' | translate }}
            </pa-checkbox>
            <pa-checkbox
              *ngIf="isEntityFiltersEnabled | async"
              [(value)]="filters.entities"
              (valueChange)="onFiltersChange()"
              [disabled]="filters.entities && hasOneFilter">
              {{ 'stash.widgets.entities' | translate }}
            </pa-checkbox>
            <div>
              <pa-checkbox
                [(value)]="filters.created"
                (valueChange)="onFiltersChange()"
                [disabled]="filters.created && hasOneFilter">
                {{ 'stash.widgets.created' | translate }}
              </pa-checkbox>
              <div
                *ngIf="filters.created"
                class="filter-warning"
                [innerHtml]="'stash.widgets.created-warning' | translate"></div>
            </div>
          </div>
          <pa-toggle
            labelOnRight
            help="stash.widgets.answers.help"
            formControlName="answers">
            {{ 'stash.widgets.answers.label' | translate }}
          </pa-toggle>
          <pa-toggle
            labelOnRight
            help="stash.widgets.onlyAnswers.help"
            formControlName="onlyAnswers">
            {{ 'stash.widgets.onlyAnswers.label' | translate }}
          </pa-toggle>
          <pa-toggle
            labelOnRight
            help="stash.widgets.hideSources.help"
            formControlName="hideSources">
            {{ 'stash.widgets.hideSources.label' | translate }}
          </pa-toggle>

          <pa-toggle
            labelOnRight
            help="stash.widgets.relations.help"
            formControlName="relations">
            {{ 'stash.widgets.relations.label' | translate }}
          </pa-toggle>
          <pa-toggle
            *ngIf="isKnowledgeGraphEnabled | async"
            labelOnRight
            help="stash.widgets.knowledgeGraph.help"
            formControlName="knowledgeGraph">
            {{ 'stash.widgets.knowledgeGraph.label' | translate }}
          </pa-toggle>
          <pa-toggle
            labelOnRight
            help="stash.widgets.navigateToLink.help"
            formControlName="navigateToLink"
            (valueChange)="updateTarget($event)">
            {{ 'stash.widgets.navigateToLink.label' | translate }}
          </pa-toggle>
          <pa-toggle
            labelOnRight
            help="stash.widgets.targetNewTab.help"
            formControlName="targetNewTab">
            {{ 'stash.widgets.targetNewTab.label' | translate }}
          </pa-toggle>
          <pa-toggle
            labelOnRight
            help="stash.widgets.navigateToFile.help"
            formControlName="navigateToFile">
            {{ 'stash.widgets.navigateToFile.label' | translate }}
          </pa-toggle>
          <pa-toggle
            labelOnRight
            help="stash.widgets.permalink.help"
            formControlName="permalink">
            {{ 'stash.widgets.permalink.label' | translate }}
          </pa-toggle>
          <pa-toggle
            *ngIf="areSynonymsEnabled | async"
            labelOnRight
            help="stash.widgets.synonyms.help"
            formControlName="useSynonyms">
            {{ 'stash.widgets.synonyms.label' | translate }}
          </pa-toggle>
          <pa-toggle
            labelOnRight
            help="stash.widgets.autofilter.help"
            formControlName="autofilter">
            {{ 'stash.widgets.autofilter.label' | translate }}
          </pa-toggle>
          <pa-toggle
            labelOnRight
            help="stash.widgets.displayMetadata.help"
            formControlName="displayMetadata">
            {{ 'stash.widgets.displayMetadata.label' | translate }}
          </pa-toggle>
          <pa-toggle
            labelOnRight
            help="stash.widgets.hideThumbnails.help"
            formControlName="hideThumbnails">
            {{ 'stash.widgets.hideThumbnails.label' | translate }}
          </pa-toggle>
          <pa-toggle
            labelOnRight
            help="stash.widgets.noBM25forChat.help"
            formControlName="noBM25forChat">
            {{ 'stash.widgets.noBM25forChat.label' | translate }}
          </pa-toggle>
          <pa-toggle
            *ngIf="canHideLogo | async"
            labelOnRight
            help="stash.widgets.hideLogo.help"
            formControlName="hideLogo">
            {{ 'stash.widgets.hideLogo.label' | translate }}
          </pa-toggle>
        </div>

        <pa-toggle
          labelOnRight
          help="stash.widgets.darkMode.help"
          formControlName="darkMode">
          {{ 'stash.widgets.darkMode.label' | translate }}
        </pa-toggle>
      </section>
      <section class="snippet">
        <h3>
          {{ 'stash.widgets.snippet' | translate }}
          <pa-button
            aspect="basic"
            icon="info"
            iconAndText
            (click)="showHints()">
            {{ 'stash.widgets.recommendations' | translate }}
          </pa-button>
          <pa-button
            *ngIf="clipboardSupported"
            aspect="basic"
            size="small"
            [icon]="copyIcon"
            (click)="copy()">
            Copy snippet
          </pa-button>
        </h3>

        <div
          class="warning"
          *ngIf="showWarning | async">
          <pa-icon name="warning"></pa-icon>
          <div class="warning-content">
            <div class="title-xxs">
              {{ 'stash.widgets.warning-dangerous-snippet' | translate }}
            </div>
            <div class="body-m">{{ 'stash.widgets.warning-dangerous-snippet-details' | translate }}</div>
          </div>
        </div>
        <pre><code class="highlight">{{ snippet }}</code></pre>
      </section>
    </div>
  </form>
</div>
