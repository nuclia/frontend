<div
  class="select-kb"
  *ngIf="(kbs | async) !== null">
  <div class="select-kb-header">
    <nsi-back-button
      *ngIf="!standalone && (hasSeveralAccounts | async)"
      class="select-kb-back"
      link="/select">
      {{ 'generic.back' | translate }}
    </nsi-back-button>

    <h2
      class="select-kb-title"
      paEllipsisTooltip>
      {{ (account | async)?.title }}
    </h2>

    <pa-button
      *ngIf="canManage | async"
      icon="gear"
      size="small"
      aspect="basic"
      class="manage-account-button"
      [paTooltip]="'generic.manage_account' | translate"
      (click)="goToAccountManage()">
      {{ 'generic.manage_account' | translate }}
    </pa-button>
  </div>

  <div class="select-kb-body">
    <div
      class="select-kb-list"
      *ngIf="((kbs | async)?.length || 0) > 0; else noKb">
      <ng-container *ngFor="let kb of kbs | async">
        <a
          *ngIf="kb.id"
          class="kb"
          data-cy="kb-list-item"
          [class.disabled]="!kb.role_on_kb"
          (click)="goToKb(kb)">
          <pa-button
            class="delete-btn"
            data-cy="delete-kb-button"
            *ngIf="standalone"
            (click)="deleteKb($event, kb.id, kb.title)"
            icon="trash"
            aspect="basic"
            kind="destructive"
            size="small"></pa-button>
          {{ kb.title }}
          <pa-icon
            *ngIf="!!kb.role_on_kb"
            name="chevron-right"
            size="small"></pa-icon>
        </a>
      </ng-container>
    </div>

    <ng-template #noKb>
      <div
        class="select-kb-empty"
        data-cy="no-kb-message"
        *ngIf="!addKb">
        <div class="select-kb-empty-message">{{ 'stash.no_knowledge_boxes' | translate }}</div>

        <div
          *ngIf="(canAddKb | async) === false"
          class="select-kb-empty-message">
          {{ 'stash.contact_admin' | translate }}
        </div>
      </div>
    </ng-template>

    <ng-container *ngIf="addKb">
      <div class="select-kb-input">
        <pa-input
          hasFocus
          data-cy="new-kb-name-input"
          [formControl]="kbName"
          [errorMessages]="errorMessages">
          {{ 'stash.name_your_kb' | translate }}
        </pa-input>
      </div>
    </ng-container>
  </div>

  <div class="select-kb-footer">
    <pa-button
      *ngIf="!addKb && (standalone || (canAddKb | async) === true)"
      data-cy="create-kb-button"
      (click)="openKbForm()">
      {{ 'stash.create.title' | translate }}
    </pa-button>

    <ng-container *ngIf="addKb">
      <pa-button
        aspect="basic"
        (click)="toggleForm()">
        {{ 'generic.cancel' | translate }}
      </pa-button>

      <pa-button
        [disabled]="kbName.invalid || creatingKb"
        data-cy="save-new-kb-button"
        (click)="save()">
        {{ 'generic.save' | translate }}
      </pa-button>
    </ng-container>
  </div>
</div>
