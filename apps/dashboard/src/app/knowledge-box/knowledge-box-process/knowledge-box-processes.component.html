<stf-section-navbar
  title="stash.side.trainings"
  [sections]="[]">
  <stf-section-navbar-body>
    <div class="knowledge-box-processes">
      <div
        *ngIf="cannotTrain | async"
        class="warning">
        {{ 'stash.settings.processes.training.not-allowed' | translate }}
      </div>
      <div
        *ngIf="!(hasResources | async)"
        class="warning">
        {{ 'stash.settings.processes.training.no-resources' | translate }}
      </div>
      <section *ngFor="let type of enabledTrainings | async">
        <h2>{{ 'stash.settings.processes.' + type | translate }}</h2>
        <p class="last-run">
          <small>
            {{
              'stash.settings.processes.training.last_run'
                | translate
                  : { runDate: trainings[type].lastRun ? (trainings[type].lastRun | date: 'YYYY-MM-dd HH:mm') : 'â€“' }
            }}
          </small>
        </p>

        <div [class.running]="trainings[type].running">
          <p>{{ 'stash.settings.processes.' + type + '.info' | translate }}</p>

          <div class="select">
            <nsi-dropdown-button
              [popupRef]="dropdown"
              [open]="trainings[type].open">
              {{
                (type === trainingTypes.ner
                  ? 'stash.settings.processes.training.select-entities'
                  : 'stash.settings.processes.training.select-labelsets'
                ) | translate
              }}
            </nsi-dropdown-button>

            <div class="selection">{{ trainings[type].selectedOptions.join(', ') }}</div>
          </div>

          <pa-dropdown
            #dropdown
            (onOpen)="trainings[type].open = true"
            (onClose)="trainings[type].open = false">
            <pa-option
              *ngIf="options[type] | async as options"
              dontCloseOnSelect>
              <pa-checkbox
                [value]="trainings[type].selectedOptions.length === options.length"
                (change)="toggleAll(type)">
                {{ 'stash.settings.processes.training.select_all' | translate }}
              </pa-checkbox>
            </pa-option>
            <pa-separator></pa-separator>
            <pa-option
              *ngFor="let option of options[type] | async"
              dontCloseOnSelect>
              <pa-checkbox
                [value]="trainings[type].selectedOptions.includes(option.value)"
                (change)="toggleOption(type, option.value)">
                {{ option.title | translate }}
              </pa-checkbox>
            </pa-option>
          </pa-dropdown>

          <ng-container *ngIf="isBillingEnabled | async">
            <p [class.warning]="!trainings[type].agreement">
              {{ 'stash.settings.processes.training.time_requirement' | translate: { hours: hoursRequired } }}
            </p>

            <div class="agreement-container">
              <pa-checkbox
                [disabled]="(cannotTrain | async) || !(hasResources | async)"
                [(value)]="trainings[type].agreement">
                {{ 'stash.settings.processes.training.agreement' | translate }}
              </pa-checkbox>
            </div>
          </ng-container>
        </div>

        <div
          *ngIf="trainings[type].running"
          class="active-training warning">
          {{ 'stash.settings.processes.training.active' | translate }}
        </div>
        <div class="cta-container">
          <pa-button
            [kind]="trainings[type].running ? 'secondary' : 'primary'"
            [disabled]="
              (!trainings[type].running && (isBillingEnabled | async) && !trainings[type].agreement) ||
              (cannotTrain | async) ||
              !(hasResources | async)
            "
            (click)="startOrStopTraining(type)">
            {{ 'stash.settings.processes.training.' + (trainings[type].running ? 'stop' : 'start') | translate }}
          </pa-button>
        </div>
      </section>
    </div>
  </stf-section-navbar-body>
</stf-section-navbar>
