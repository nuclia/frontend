<div class="my-subscription">
  <h2>{{ 'billing.my-subscription' | translate }}</h2>

  <ng-container *ngIf="!(cancelScheduled | async)">
    <div
      class="subscription-info"
      *ngIf="prices$ | async as prices">
      <div class="subscription-tier">
        <div class="title-l">{{ 'account.type.' + (type | async) | translate }}</div>
        <div>
          <span
            class="title-l price"
            *ngIf="currency$ | async as currency">
            {{ prices.recurring.month.price | currency: currency }}
          </span>
          <span class="unit">/{{ 'billing.month' | translate }}</span>
        </div>
      </div>
      <pa-table
        columns="auto auto auto"
        *ngIf="currency$ | async as currency">
        <pa-table-header>
          <pa-table-cell header>{{ 'billing.quotas_label' | translate }}</pa-table-cell>
          <pa-table-cell header></pa-table-cell>
          <pa-table-cell header>{{ 'billing.cost_over_limits' | translate }}</pa-table-cell>
        </pa-table-header>
        <pa-table-row>
          <pa-table-cell>
            <span class="body-m">{{ 'billing.quotas.kbs' | translate }}</span>
          </pa-table-cell>
          <pa-table-cell>
            <span class="body-m">{{ (defaults | async)?.max_kbs || '' }}</span>
          </pa-table-cell>
          <pa-table-cell>-</pa-table-cell>
        </pa-table-row>
        <pa-table-row *ngFor="let param of params">
          <pa-table-cell>
            <span class="body-m">{{ 'billing.quotas.' + param | translate }}</span>
          </pa-table-cell>
          <pa-table-cell>
            <span class="body-m">
              {{ prices.usage[param].threshold | number }}
              {{ param === 'media' ? ('billing.hours' | translate) : '' }}
            </span>
          </pa-table-cell>
          <pa-table-cell>
            <span>
              <span class="body-m">{{ prices.usage[param].price | currency: currency : 'symbol' : '1.2-6' }}</span>
              <span class="unit">
                /{{ (['media', 'training'].includes(param) ? 'billing.hour' : 'billing.unit') | translate }}
              </span>
            </span>
          </pa-table-cell>
        </pa-table-row>
      </pa-table>
      <div
        class="title-s"
        *ngIf="activeSubscription | async">
        {{ 'billing.next-payment' | translate }}:
        <pa-datetime
          [datetime]="(subscription | async)?.end_billing_period || ''"
          format="human"
          dateOnly></pa-datetime>
      </div>
    </div>

    <div
      class="cancel-subscription"
      *ngIf="activeSubscription | async">
      <div>
        <h3 class="title-s">{{ 'billing.end-service' | translate }}</h3>
        <div>{{ 'billing.cancel-renewal' | translate }}</div>
      </div>
      <pa-button
        (click)="delete()"
        kind="destructive">
        {{ 'billing.end-subscription' | translate }}
      </pa-button>
    </div>
  </ng-container>

  <ng-container *ngIf="cancelScheduled | async">
    <div class="title-m">
      {{ 'billing.subscription-end' | translate }}
      <pa-datetime
        [datetime]="(subscription | async)?.end_billing_period || ''"
        format="human"
        dateOnly></pa-datetime>
    </div>

    <div class="renewal">
      <h3 class="title-s">{{ 'billing.renew-subscription' | translate }}</h3>
      <pa-button (click)="reactivate()">
        {{ 'billing.reactivate' | translate }}
      </pa-button>
    </div>

    <div class="warning">
      <pa-icon name="warning"></pa-icon>
      <div>{{ 'billing.delete-warning' | translate }}</div>
    </div>
  </ng-container>
</div>
